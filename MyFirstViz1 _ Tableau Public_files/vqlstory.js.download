/*! BEGIN StoryModule */
(function(){'dont use strict';var a={};global.tab=global.tab||{};ss.initAssembly(a,'vqlstory');var b=global.tab.FlipboardNavigatorExtensions=ss.mkType(a,'tab.FlipboardNavigatorExtensions',null,null,{getViewModelFromStoryId:function(y,z){return _.find(y,function(A){return A.get_storyPointId()===z;});}});var c=global.tab.FlipboardNavigatorPointsTemplate=ss.mkType(a,'tab.FlipboardNavigatorPointsTemplate',function(){this.points=null;spiff.Template.call(this,$("<span class='tabFlipboardNavPoints'></span>"));this.points=this.domRoot;});var d=global.tab.FlipboardNavigatorView=ss.mkType(a,'tab.FlipboardNavigatorView',function(y){this.$o=null;this.$q=null;this.$p=null;this.$s=0;this.$r=null;ss.makeGenericType(spiff.BaseView$1,[tab.IFlipboardNavigatorViewModel]).call(this,y,new tab.FlipboardNavigatorTemplate());this.$s=0;this.$m();this.$g();this.get_flipboardNavViewModel().add_zoneResized(ss.mkdel(this,this.handleResized));this.get_flipboardNavViewModel().add_zoneResized(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().add_activePointUpdated(ss.mkdel(this,this.handleActivePointUpdated));this.get_flipboardNavViewModel().add_remoteUpdateComplete(ss.mkdel(this,this.$c));this.get_flipboardNavViewModel().add_findParentScroller(ss.mkdel(this,function(){return this.get_dom().scroller;}));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_flipboardNavViewModel().remove_zoneResized(ss.mkdel(this,this.handleResized));this.get_flipboardNavViewModel().remove_zoneResized(ss.mkdel(this,this.$a));this.get_flipboardNavViewModel().remove_activePointUpdated(ss.mkdel(this,this.handleActivePointUpdated));this.get_flipboardNavViewModel().remove_remoteUpdateComplete(ss.mkdel(this,this.$c));this.get_flipboardNavViewModel().remove_findParentScroller(ss.mkdel(this,function(){return this.get_dom().scroller;}));tab.StyleUtil.clearStyleSheet('appendedStoryStyle');})));this.$b();},{get_domRoot:function(){return this.get_template().domRoot;},get_flipboardNavViewModel:function(){return this.get_viewModel();},get_storyPointCaptionViewModel:function(){return ss.getItem(this.get_flipboardNavViewModel().get_captions(),0);},get_dom:function(){return ss.cast(this.get_template(),tab.FlipboardNavigatorTemplate);},get_scrollingView:function(){return this.$p;},$n:function(){var y=((this.get_flipboardNavViewModel().get_navType()==='arrowonly')?0:this.get_flipboardNavViewModel().get_currentPointIndex());return this.$o.points.children().get(y);},$b:function(){this.$o=new c();var y=new spiff.ScrollableViewModel.$ctor1(false);y.set_content(this.$o.domRoot[0]);y.set_scrollX(true);this.$q=y;this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){tab.StyleUtil.clearStyleSheet('flipboardNavScroller');this.$q.dispose();})));},$m:function(){if(this.get_flipboardNavViewModel().get_useDarkIcons()){this.get_domRoot().addClass('tabDarkIcons');}else{this.get_domRoot().addClass('tabLightIcons');}var y=this.get_flipboardNavViewModel().get_scrollBarStyle();if(ss.isValue(y)){tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar',{'background-color':y.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar:hover',ss.mkdict(['background-color',y.bgActiveColor]));tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator',{'background-color':y.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('flipboardNavScroller','.tabFlipboardNavScroller .iScrollHorizontalScrollbar>.iScrollIndicator:hover',{'background-color':y.color});}},$g:function(){var y=new spiff.Button(this.get_dom().previous);var z=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickPrevious();});y.add_click(z);this.disposables.add$1(y);this.disposables.add$1(new tab.CallOnDispose(function(){y.remove_click(z);}));var A=new spiff.Button(this.get_dom().next);var B=ss.mkdel(this,function(){this.get_flipboardNavViewModel().clickNext();});A.add_click(B);this.disposables.add$1(A);this.disposables.add$1(new tab.CallOnDispose(function(){A.remove_click(B);}));},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$p=spiff.ScrollableView.createScrollableView(this.$q);this.$p.addToDom(this.get_dom().scroller);this.$c();},$c:function(){this.get_dom().previous.toggle(this.get_flipboardNavViewModel().get_showArrows());this.get_dom().next.toggle(this.get_flipboardNavViewModel().get_showArrows());var y=this.get_dom().previous.add(this.get_dom().next);var z=this.get_flipboardNavViewModel().get_storyPointHeight();var A=z+20;this.$d();var B=tab.DoubleUtil.roundToInt(this.get_dom().previousArrow.height());var C=ss.idiv(z-B,2);var D;if(C<0){D=ss.mkdict(['padding-top','0px','padding-bottom','0px','margin-bottom',ss.idiv(this.$p.get_scrollbarBuffer(),2)+'px']);}else{D=ss.mkdict(['padding-top',C+'px','padding-bottom',C+'px','margin-bottom',this.$p.get_scrollbarBuffer()+'px']);}y.css(D);this.$j();if(ss.isValue(A)){this.get_dom().scroller.css('height',A+this.$p.get_scrollbarBuffer()+'px');}this.$e();this.$f(ss.mkdel(this,this.$l));},$d:function(){var y=this.get_dom().previous.add(this.get_dom().next);y.removeClass('ArrowLarge');y.removeClass('ArrowSmall');if(this.get_flipboardNavViewModel().get_navType()==='caption'){y.addClass('ArrowLarge');}else if(this.get_flipboardNavViewModel().get_navType()==='number'||this.get_flipboardNavViewModel().get_navType()==='arrowonly'||this.get_flipboardNavViewModel().get_navType()==='dot'){y.addClass('ArrowSmall');}},$j:function(){if(ss.isNullOrUndefined(this.get_storyPointCaptionViewModel())){return;}var y={};var z={};var A={};var B={};var C={};if(ss.isValue(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle())){y=this.$h(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());A=this.$k(this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle());C=this.$i();}if(ss.isValue(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle())){z=this.$h(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());B=this.$k(this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle());if(Object.keys(C).length<=0){C=this.$i();}}tab.StyleUtil.clearStyleSheet('appendedStoryStyle');tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabFlipboardNavScroller .tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint',C);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent',y);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption',z);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom',y);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabStoryPointCaptionTop,.tabStoryPointCaption .tabStoryPointCaptionBottom',z);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabScroller .tabScrollerContent .tabStoryPointContent',A);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabScroller .tabScrollerContent .tabStoryPointContent',B);tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.bgRestColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.defaultColor});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption.tabCurrent .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_selectedStoryPointStyle().scrollBarStyle.color});tab.StyleUtil.appendCSSRuleToStyleSheet$1('appendedStoryStyle','.tabStoryPointCaption .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover',{'background-color':this.get_storyPointCaptionViewModel().get_unselectedStoryPointStyle().scrollBarStyle.color});},$h:function(y){var z=false;if(ss.isValue(y.styledBox)){return tab.FormattingConverters.makeStyledBoxCssDict(y.styledBox,z);}else{return {};}},$k:function(y){if(ss.isValue(y.textStyle)){return tab.FormattingConverters.makeFormatStyleDict(y.textStyle,null);}else{return {};}},$i:function(){var y=150;var z=70;var A={};var B=z,C=y;if(ss.isValue(this.get_viewModel().get_storyPointHeight())){B=this.get_viewModel().get_storyPointHeight();}A.height=B+20+'px';if(ss.isValue(this.get_viewModel().get_storyPointWidth())){C=this.get_viewModel().get_storyPointWidth();}A.width=C+'px';return A;},handleResized:function(){var y=tab.DoubleUtil.roundToInt(this.get_dom().domRoot.parent().width())-this.$8();var z=this.$o.points[0].clientWidth;this.get_dom().scroller.css(ss.mkdict(['width',Math.min(y,z)+'px']));this.$q.triggerRefresh();},$a:function(){this.get_viewModel().closeUberMenu();},$8:function(){return (this.get_flipboardNavViewModel().get_showArrows()?(tab.DoubleUtil.roundToInt(this.get_dom().previous.outerWidth(true))+tab.DoubleUtil.roundToInt(this.get_dom().next.outerWidth(true))):0);},handleActivePointUpdated:function(){this.$e();this.$f(ss.mkdel(this,this.$l));},$l:function(){var y=this.$n();if(ss.isNullOrUndefined(y)){return;}var z=y.offsetLeft;var A=z+y.offsetWidth;var B=this.$p.get_scrollerX();var C=B+tab.DoubleUtil.roundToInt(this.get_dom().scroller.width());var D=50;if(A>C){var E=tab.DoubleUtil.roundToInt(this.get_dom().scroller.width())-y.offsetWidth-D;this.$p.scrollToElement(y,0,-E,0);}else if(z<B){this.$p.scrollToElement(y,0,-D,0);}this.get_dom().previous.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_previousDisabled());this.get_dom().next.toggleClass('tabDisabled',this.get_flipboardNavViewModel().get_nextDisabled());},$e:function(){this.$r=[];this.$9();this.$f(ss.mkdel(this,this.handleResized));},$9:function(){var y=this.get_template().getElementsBySelector('.tabStoryPoint');y.remove();var z=ss.getEnumerator(this.get_flipboardNavViewModel().get_captions());try{while(z.moveNext()){var A=z.current();if(A.get_shouldBeAdded()){this.$7(A);}}}finally{z.dispose();}},$7:function(y){var z=tab.ObjectRegistry.newDeferred(j).call(null,[y]);this.$r.push(z);z.done(ss.mkdel(this,function(A){A.addToDom(this.$o.points);}));},$f:function(y){$.when.apply(null,this.$r).done([y]);}});var e=global.tab.FlipboardNavigatorViewModel=ss.mkType(a,'tab.FlipboardNavigatorViewModel',function(y){this.$f=null;this.$c=[];this.$e=false;this.$d=null;this.$b=null;this.$g=null;this.$2$1=null;this.$2$2=null;this.$2$3=null;this.$2$4=null;this.$2$5=null;spiff.BaseViewModel.call(this);this.$f=y;this.$f.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$f.get_zone().get_zoneCommonModel().add_resizeZone(ss.mkdel(this,this.$4));this.$f.add_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$f.add_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));EventUtils.GlobalUIEvents.add_DismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));w.$2(ss.mkdel(this,this.closeUberMenu));w.$4(ss.mkdel(this,this.handlePointWasCaptured));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$f.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.$f.get_zone().get_zoneCommonModel().remove_resizeZone(ss.mkdel(this,this.$4));this.$f.remove_pointWasCaptured(ss.mkdel(this,this.handlePointWasCaptured));this.$f.remove_navArrowVisibilityChanged(ss.mkdel(this,this.handleNavArrowVisibilityChanged));EventUtils.GlobalUIEvents.remove_DismissTemporaryElements(ss.mkdel(this,this.hideUberMenuImmediately));w.$3(ss.mkdel(this,this.closeUberMenu));w.$5(ss.mkdel(this,this.handlePointWasCaptured));this.$g.done(function(A){A.dispose();});})));this.$g=tab.ObjectRegistry.newDeferred(k).call(null,[]);this.$d=[];this.$b=[];this.$1();var z=null;z=ss.mkdel(this,function(){this.$a();tab.CommandController.get().remove_commandQueueComplete(z);});tab.CommandController.get().add_commandQueueComplete(z);tab.StartupUtils.callOnceAfterInitialBootstrap(ss.mkdel(this,this.$a));},{add_zoneResized:function(y){this.$2$1=ss.delegateCombine(this.$2$1,y);},remove_zoneResized:function(y){this.$2$1=ss.delegateRemove(this.$2$1,y);},add_activePointUpdated:function(y){this.$2$2=ss.delegateCombine(this.$2$2,y);},remove_activePointUpdated:function(y){this.$2$2=ss.delegateRemove(this.$2$2,y);},add_remoteUpdateComplete:function(y){this.$2$3=ss.delegateCombine(this.$2$3,y);},remove_remoteUpdateComplete:function(y){this.$2$3=ss.delegateRemove(this.$2$3,y);},add_flipboardNavigatorUpdated:function(y){this.$2$4=ss.delegateCombine(this.$2$4,y);},remove_flipboardNavigatorUpdated:function(y){this.$2$4=ss.delegateRemove(this.$2$4,y);},add_findParentScroller:function(y){this.$2$5=ss.delegateCombine(this.$2$5,y);},remove_findParentScroller:function(y){this.$2$5=ss.delegateRemove(this.$2$5,y);},get_handlingOfContextMenuEventsRequired:function(){if(!tsConfig.is_authoring||tab.ApplicationModel.get_instance().get_currentSheetType()!=='story'){return false;}return tabBootstrap.FeatureFlags.isEnabled('BEAuthoring_ContextMenus_StoryPoint');},get_currentPointIndex:function(){return this.$f.get_currentPointIndex();},get_numberOfPoints:function(){return this.$f.get_storyPoints().length;},get_storyPointHeight:function(){return this.$f.get_height();},get_storyPointWidth:function(){return this.$f.get_width();},get_previousDisabled:function(){return this.get_currentPointIndex()<=0;},get_nextDisabled:function(){return this.get_currentPointIndex()>=this.get_numberOfPoints()-1;},get_showArrows:function(){return this.$f.get_flipboardNavPresModel().navArrowsVisible;},get_captions:function(){return this.$c;},get_useDarkIcons:function(){return this.$f.get_flipboardNavPresModel().flipboardNavStyle.useDarkIcons;},get_scrollBarStyle:function(){return this.$f.get_flipboardNavPresModel().flipboardNavStyle.scrollBarStyle;},get_navType:function(){return this.$f.get_navType();},get_currentStoryPointId:function(){return (ss.isValue(this.$f)?this.$f.get_storyPoints()[this.get_currentPointIndex()].storyPointId:0);},handleNewFlipboardNav:function(){if(ss.isValue(this.$2$2)){this.updatePoints();this.$2$2();}if(!this.$e){var y=tab.CommandController.get();var z=null;z=ss.mkdel(this,function(){y.remove_commandQueueComplete(z);this.$e=false;this.raiseActionEvent(this.$2$3);this.$5();this.$g.done(ss.mkdel(this,function(A){A.updatePoints(this.$c,this.get_currentStoryPointId());}));});y.add_commandQueueComplete(z);this.$e=true;}},handlePointWasCaptured:function(y){var z=((this.get_navType()==='arrowonly')?this.get_currentStoryPointId():y);this.$d.push(z);},handleNavArrowVisibilityChanged:function(){this.closeUberMenu();},updatePoints:function(){this.$8();this.$1();},$5:function(){for(var y=0;y<this.$d.length;y++){var z=this.$d[y];this.$6(z);}},$6:function(y){var z=b.getViewModelFromStoryId(this.$c,y);if(ss.isValue(z)){z.notifyPointWasCaptured();}},$4:function(){this.closeUberMenu();this.raiseActionEvent(this.$2$1);},$8:function(){for(var y=this.$c.length-1;y>=0;y--){this.$7(y);}},$7:function(y){var z=this.$c[y];z.remove_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));z.remove_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));z.remove_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));z.remove_closeUberMenu(ss.mkdel(this,this.closeUberMenu));z.remove_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));z.remove_findParentScroller(ss.mkdel(this,this.$3));z.dispose();ss.remove(this.$c,z);ss.removeAt(this.$b,y);},$1:function(){ss.clear(this.$b);for(var y=0;y<this.get_numberOfPoints();y++){var z=new v(this.$f,y);this.$0(z);this.$b.push(z.get_storyPointId());}},$0:function(y){y.add_pointUpdatedShown(ss.mkdel(this,this.clearUpdatedPoint));y.add_showUberMenuForPoint(ss.mkdel(this,this.showUberMenu));y.add_hideUberMenuForPoint(ss.mkdel(this,this.hideUberMenu));y.add_closeUberMenu(ss.mkdel(this,this.closeUberMenu));y.add_showUpdatedToastOnReload(ss.mkdel(this,this.handlePointWasCaptured));y.add_findParentScroller(ss.mkdel(this,this.$3));this.$c.push(y);},$3:function(){return (ss.isValue(this.$2$5())?this.$2$5():null);},clearUpdatedPoint:function(y){ss.remove(this.$d,y);},showUberMenu:function(y){this.$g.done(function(z){z.showUber(y);});},hideUberMenu:function(y){this.$g.done(function(z){z.hideUberWithTimeoutAndFade();});},hideUberMenuImmediately:function(){this.$g.done(function(y){y.hideUberWithFade();});},$a:function(){this.$g.done(ss.mkdel(this,function(y){y.updatePoints(this.$c,this.get_currentStoryPointId());}));},closeUberMenu:function(){this.$g.done(function(y){y.close();});},clickNext:function(){return this.$2(l.nextStoryPoint,this.get_nextDisabled());},clickPrevious:function(){return this.$2(l.previousStoryPoint,this.get_previousDisabled());},$2:function(y,z){var A=$.Deferred();if(z){A.resolve(this.get_currentPointIndex());}else{this.$9(A,ss.mkdel(this,function(){return y(this.$f);}));}this.closeUberMenu();return A.promise();},dispose:function(){this.$8();spiff.BaseViewModel.prototype.dispose.call(this);},$9:function(y,z){var A=ss.mkdel(this,function(){y.resolve(this.get_currentPointIndex());});var B=function(){y.reject(ss.unbox(ss.cast(arguments[0],ss.Int32)));};z().then(A,B);}});var f=global.tab.FlipboardTemplate=ss.mkType(a,'tab.FlipboardTemplate',function(){spiff.Template.call(this,$("<div class='tabFlipboard'></div>"));});var g=global.tab.FlipboardView=ss.mkType(a,'tab.FlipboardView',function(y){this.$8=null;ss.makeGenericType(spiff.BaseView$1,[h]).call(this,y,new f());this.$8=y;this.$8.add_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$8.get_parentZone().add_resizeZone(ss.mkdel(this,this.handleResizeZone));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$8.remove_newStoryPoint(ss.mkdel(this,this.handleNewStoryPoint));this.$8.get_parentZone().remove_resizeZone(ss.mkdel(this,this.handleResizeZone));})));},{onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);if(ss.isValue(this.$8.get_dashboardViewModel())){this.handleNewStoryPoint();}},handleNewStoryPoint:function(){var y={w:tab.DoubleUtil.roundToInt(this.element.width()),h:tab.DoubleUtil.roundToInt(this.element.height())};this.$8.get_dashboardViewModel().set_size(g.$0(tab.RecordCast.sizeAsSizePresModel(y),this.$8.get_dashboardViewModel().get_size()));this.$7();var z=tab.ObjectRegistry.newView(tab.DashboardView).call(null,[this.$8.get_dashboardViewModel()]);z.addToDom(this.get_template().domRoot);},handleResizeZone:function(){var y={w:this.$8.get_parentZone().get_contentWidth(),h:this.$8.get_parentZone().get_contentHeight()};this.$8.get_dashboardViewModel().set_size(g.$0(tab.RecordCast.sizeAsSizePresModel(y),this.$8.get_dashboardViewModel().dashboardModel.get_dashboardSize()));this.$7();},$7:function(){var y=this.$8.get_parentZone().get_contentWidth();var z=this.$8.get_parentZone().get_contentHeight();var A=this.$8.get_dashboardViewModel().dashboardModel.get_dashboardSize();if(A.w<=y&&A.h<=z+3){this.element.css('overflow','hidden');}else{this.element.css('overflow','auto');}}},{findFlipboard:function(){return $('.'+'tabFlipboard');},$0:function(y,z){var A=tab.SizePresModelUtils.unionPresModels(y,z);if(z.h>=y.h+3&&y.w-z.w>24){A.w-=24;}if(z.w>=y.w&&y.h+3-z.h>24){A.h-=24;}return A;}});var h=global.tab.FlipboardViewModel=ss.mkType(a,'tab.FlipboardViewModel',function(y,z){this.$5=null;this.$6=null;this.$4=null;this.$2$1=null;spiff.BaseViewModel.call(this);this.$5=y;this.$6=z;this.$5.add_invalidateZone(ss.mkdel(this,this.$2));this.$5.get_storyPointModel().add_newStoryPoint(ss.mkdel(this,this.$1));this.$5.get_storyPointModel().add_dashboardDisposal(ss.mkdel(this,this.$0));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$5.remove_invalidateZone(ss.mkdel(this,this.$2));this.$5.get_storyPointModel().remove_newStoryPoint(ss.mkdel(this,this.$1));this.$5.get_storyPointModel().remove_dashboardDisposal(ss.mkdel(this,this.$0));})));if(ss.isValue(this.get_flipboardModel().get_dashboardModel())){this.$1();}},{add_newStoryPoint:function(y){this.$2$1=ss.delegateCombine(this.$2$1,y);},remove_newStoryPoint:function(y){this.$2$1=ss.delegateRemove(this.$2$1,y);},get_flipboardModel:function(){return this.$5;},get_storyPointId:function(){return this.$5.get_storyPointModel().get_storyPointId();},get_dashboardViewModel:function(){return this.$4;},$3:function(){return this.get_flipboardModel().get_dashboardModel().pm;},get_parentZone:function(){return this.$6;},$1:function(){this.$0();if(ss.isValue(this.$3())){this.$4=tab.DashboardViewModel.new$1(this.get_flipboardModel().get_dashboardModel());this.raiseActionEvent(this.$2$1);}tab.Application.handleAllFontsFound();},$2:function(){this.$6.forceZoneValidState(false);},dispose:function(){this.$0();spiff.BaseViewModel.prototype.dispose.call(this);},$0:function(){if(ss.isValue(this.get_dashboardViewModel())){this.$4.dispose();this.$4=null;}}});var i=global.tab.IStoryNavigatorContentView=ss.mkType(a,'tab.IStoryNavigatorContentView');var j=global.tab.IStoryNavigatorPointView=ss.mkType(a,'tab.IStoryNavigatorPointView');var k=global.tab.IStoryUberPopupContainer=ss.mkType(a,'tab.IStoryUberPopupContainer');var l=global.tab.StoryClientCommands=ss.mkType(a,'tab.StoryClientCommands',null,null,{setActiveStoryPoint:function(y,z){var A=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()||z.get_currentPointIndex()===y){A.resolve();return A.promise();}var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=z.get_storyPoints()[y].storyPointId;var D=new tab.ClientCommand('afterDelay',function(E){l.$n(C,z,E,B);},l.$0(z.get_storyPoints()[y].storyPointId,tsConfig.is_authoring),function(E){A.resolve(E);},function(E){A.reject(E);});tab.CommandController.SendCommand(D);return A.promise();},nextStoryPoint:function(y){var z=$.Deferred();if(!tab.ApplicationModel.get_instance().get_workbook().get_isCurrentSheetStoryboard()){z.reject("The workbook's current sheet is not a story");return z.promise();}var A=y.get_currentPointIndex()+1;var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=l.$g(y,z,B,A);var D=y.get_storyPoints()[A].storyPointId;var E=new tab.ClientCommand('afterDelay',function(F){l.$n(D,y,F,B);},l.$7(tsConfig.is_authoring),function(F){z.resolve(F);},function(F){z.reject(F);});tab.CommandController.SendCommand(E);return C;},previousStoryPoint:function(y){var z=$.Deferred();if(ss.isNullOrUndefined(tab.ApplicationModel.get_instance().get_workbook().get_storyboard())){z.reject("The workbook's current sheet is not a story");return z.promise();}var A=y.get_currentPointIndex()-1;var B=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();var C=l.$g(y,z,B,A);var D=y.get_storyPoints()[A].storyPointId;var E=new tab.ClientCommand('afterDelay',function(F){l.$n(D,y,F,B);},l.$8(tsConfig.is_authoring),function(F){z.resolve(F);},function(F){z.reject(F);});tab.CommandController.SendCommand(E);return C;},revertStoryPoint:function(y,z){return l.$m(l.$l,l.$b(y,z),'none');},setFlipboardNavType:function(y){return l.$m(function(z){},l.$d(y),'none');},captureStoryPoint:function(y){return l.$m(function(z){},l.$1(y),'none');},newBlankStoryPoint:function(){return l.$m(function(y){},l.$6(),'none');},duplicateActiveStoryPoint:function(){return l.$m(function(y){},l.$3(),'none');},saveActiveStoryPointAsNew:function(){return l.$m(function(y){},l.$c(),'immediately');},toggleArrows:function(){return l.$m(function(y){},l.$f(),'none');},toggleShowStoryboardTitle:function(y){return l.$m(function(z){},l.$e(y),'immediately');},insertStoryPoint:function(y,z){return l.$m(function(A){},l.$5(y,z),'none');},replaceStoryPoint:function(y,z){return l.$m(function(A){},l.$a(y,z),'none');},reorderStoryPoint:function(y,z){return l.$m(function(A){},l.$9(y,z),'none');},deleteStoryPoint:function(y){return l.$m(function(z){},l.$2(y),'none');},editStoryPointCaption:function(y,z,A){return l.$m(function(B){l.$i(y,A,B);},l.$4(y,z),'none');},addNewTextZoneToStoryboard:function(){var y=new tab.AddObjectToDashboardCmd();y.set_dashboard(tsConfig.current_sheet_name);y.set_zoneType('text');y.set_isHorizontal(false);y.set_addAsFloating(true);y.set_uiBlocking('immediately');var z=y;return z.invoke();},$g:function(y,z,A,B){var C=z.promise();if(!tsConfig.is_authoring){var D=B+(B-y.get_currentPointIndex());if(D>=0&&D<y.get_flipboardNavPresModel().storypointNavItems.length){var E=y.get_flipboardNavPresModel().storypointNavItems[D].storyPointId;C=C.then(function(){_.defer(function(){l.$k(A,E);});},null);}}return C;},$k:function(y,z){if(ss.isNullOrUndefined(tab.FlipboardModel.presModelCache)||tab.FlipboardModel.presModelCache.hasStoryPoint(z)){return;}var A=tab.CommandUtils.newCommand({ns:'tabsrv',cmd:'get-storypoint'},null);var B={};B['storyboard']=tsConfig.current_sheet_name;B['storyPointId']=z;A.commandParams=B;var C=function(E){var F=E;if(ss.isValue(F)&&ss.isValue(F.dashboardPresModel)){tab.FlipboardModel.presModelCache.addStoryPoint(z,F);}};var D=tab.ClientCommand.createRemoteOnly(A,'none',C,null);tab.CommandController.SendCommand(D);},$l:function(y){l.$j(y);},$b:function(y,z){var A=tab.CommandUtils.newCommand({ns:'tabdoc',cmd:'revert-story-point'},null);A.commandParams={};tab.CommandUtils.addStoryPointToCommand(A.commandParams,y);A.commandParams['storyPointId']=z.toString();return A;},$1:function(y){var z=l.$h({ns:'tabdoc',cmd:'capture-story-point'});z.commandParams['storyPointId']=y.toString();return z;},$i:function(y,z,A){if(ss.isValue(z)){var B=z.get_storyPoints()[z.get_currentPointIndex()];var C=A.makeMutablePresModel(z,false);B=C.storypointNavItems[z.get_currentPointIndex()];B.storyPointCaption=y;}},$n:function(y,z,A,B){if(ss.isValue(z)){var C=z.get_flipboardNavPresModel();var D=0;var E=false;var F=C.storypointNavItems;for(var G=0,H=F.length;G<H;G++){if(F[G].storyPointId===y){D=G;E=true;break;}}if(E){C=A.makeMutablePresModel(z,false);C.currentStorypointIndex=D;}}if(ss.isValue(B)&&!tsConfig.is_authoring&&ss.isValue(tab.FlipboardModel.presModelCache)&&tab.FlipboardModel.presModelCache.hasStoryPoint(y)){var I=tab.FlipboardModel.presModelCache.getStoryPoint(y);if(tab.ApplicationModel.get_instance().get_renderMode()!=='render-mode-client'){var J=A.makeMutablePresModel(tab.ApplicationModel.get_instance(),false);J.renderMode='render-mode-client';}var K=A.makeMutablePresModel(B,true);K.activeStoryPointId=y;K.storyPoints[y.toString()]=I;var L=A.makeMutablePresModel(tab.ApplicationModel.get_instance().get_dataDictionary(),false);L.dataSegments={};if(tab.FeatureParamsLookup.getBool(43)){tabBootstrap.MetricsController.logMetricsEvent('StoryCacheHit',32,null);}}else{l.$j(A);}},$0:function(y,z){var A=l.$h({ns:'tabdoc',cmd:'set-active-story-point'});A.commandParams['storyPointId']=y.toString();A.commandParams['shouldAutoCapture']=(z?'true':'false');A.commandParams['shouldAutoRevert']=(z?'false':'true');return A;},$7:function(y){var z=l.$h({ns:'tabdoc',cmd:'next-story-point'});z.commandParams['shouldAutoCapture']=(y?'true':'false');z.commandParams['shouldAutoRevert']=(y?'false':'true');return z;},$8:function(y){var z=l.$h({ns:'tabdoc',cmd:'previous-story-point'});z.commandParams['shouldAutoCapture']=(y?'true':'false');z.commandParams['shouldAutoRevert']=(y?'false':'true');return z;},$d:function(y){var z=l.$h({ns:'tabdoc',cmd:'set-flipboard-nav-type'});z.commandParams['flipboardNavType']=y;return z;},$5:function(y,z){var A=l.$h({ns:'tabdoc',cmd:'insert-story-point'});A.commandParams['currentStorypointIndex']=z;A.commandParams['storyPointBase']=y;return A;},$a:function(y,z){var A=l.$h({ns:'tabdoc',cmd:'replace-story-point'});A.commandParams['storyPointId']=z;A.commandParams['storyPointBase']=y;return A;},$9:function(y,z){var A=l.$h({ns:'tabdoc',cmd:'reorder-story-points'});A.commandParams['storyPointId']=y;A.commandParams['currentStorypointIndex']=z;return A;},$2:function(y){var z=l.$h({ns:'tabdoc',cmd:'delete-story-point'});z.commandParams['storyPointId']=y;return z;},$6:function(){return l.$h({ns:'tabdoc',cmd:'new-blank-story-point'});},$3:function(){return l.$h({ns:'tabdoc',cmd:'duplicate-active-story-point'});},$c:function(){return l.$h({ns:'tabdoc',cmd:'save-active-story-point-as-new'});},$f:function(){return l.$h({ns:'tabdoc',cmd:'toggle-storypoints-nav-arrows'});},$4:function(y,z){var A=l.$h({ns:'tabdoc',cmd:'edit-story-point-caption'});A.commandParams['storyPointCaption']=y;A.commandParams['storyPointId']=z.toString();return A;},$e:function(y){var z=tab.CommandUtils.newCommand({ns:'tabdoc',cmd:'show-storyboard-title'},null);var A={};A['dashboard']=y;z.commandParams=A;return z;},$h:function(y){var z=tab.CommandUtils.newCommand(y,null);var A={};A['storyboard']=tsConfig.current_sheet_name;z.commandParams=A;return z;},$j:function(y){var z=tab.ApplicationModel.get_instance().get_workbook().get_storyboard().get_flipboard();if(ss.isValue(z)){z.invalidated(y.modelUpdateContext);}},$m:function(y,z,A){var B=$.Deferred();var C=new tab.ClientCommand(A,y,z,function(D){B.resolve(D);},function(D){B.reject(D);});tab.CommandController.SendCommand(C);return B;}});var m=global.tab.StoryFactory=ss.mkType(a,'tab.StoryFactory',function(){},{newFlipboardNavigatorViewModel:function(y){return new e(y);},newFlipboardViewModel:function(y,z){return new h(y,z);},newFlipboardNavigatorView:function(y){return tab.ObjectRegistry.newDeferred(tab.IFlipboardNavigatorView).call(null,[y]);},newFlipboardView:function(y){return tab.ObjectRegistry.newView(g).call(null,[y]);},insertStoryPoint:function(y,z){return l.insertStoryPoint(y,z);},replaceStoryPoint:function(y,z){return l.replaceStoryPoint(y,z);},fireCloseStoryUberMenu:function(){w.$0();},fireShowUpdateToast:function(y){w.$1(y);}});var n=global.tab.StoryHelperFunctions=ss.mkType(a,'tab.StoryHelperFunctions',null,null,{isTableauFontName:function(y){return ss.startsWithString(y.toUpperCase(),'TABLEAU');},shouldUseHackForArrowOnlyNavigator:function(y,z){return z==='arrowonly'&&n.isTableauFontName(y);}});var o=global.tab.StoryNavigatorContentViewFactory=ss.mkType(a,'tab.StoryNavigatorContentViewFactory',null,null,{createContentView:function(y){if(y.get_navType()==='dot'){return new q(y);}else if(y.get_navType()==='arrowonly'){var z=y.get_selectedStoryPointStyle().textStyle.fontName;if(n.shouldUseHackForArrowOnlyNavigator(z,y.get_navType())){return new r(y);}else{return new s(y);}}else{return new s(y);}}});var p=global.tab.StoryNavigatorPointView=ss.mkType(a,'tab.StoryNavigatorPointView',function(y){p.$ctor1.call(this,y,o.createContentView(y));},{get_domRoot:function(){return this.get_template().domRoot;},get_contentTemplate:function(){return ss.cast(this.$k.get_rootTemplate(),t);},get_storyPointCaptionViewModel:function(){return this.get_viewModel();},get_storyNavigatorContentView:function(){return this.$k;},get_captionTemplate:function(){return ss.cast(this.get_template(),u);},onAddedToDom:function(){spiff.Widget.prototype.onAddedToDom.call(this);this.$b();},$b:function(){this.$k.addToDom(this.get_captionTemplate().caption);this.$k.styleCaption(this.get_captionTemplate());this.$c();},$e:function(){this.get_domRoot().toggleClass('tabFirstPoint',this.get_storyPointCaptionViewModel().get_isFirstPoint());this.get_domRoot().toggleClass('tabLastPoint',this.get_storyPointCaptionViewModel().get_isLastPoint());},$d:function(){this.$k.dispose();this.$k=o.createContentView(this.get_viewModel());this.$g();this.$k.addToDom(this.get_captionTemplate().caption);this.get_captionTemplate().caption.removeAttr('style');this.get_captionTemplate().caption.removeClass(q.circleClassName);this.get_captionTemplate().domRoot.removeClass(q.storyPointDotClassName);this.$k.styleCaption(this.get_captionTemplate());},$c:function(){if(this.get_viewModel().get_navType()!=='caption'){this.$7();}if(tsConfig.is_authoring){this.get_captionTemplate().revert.hide();}else{this.get_captionTemplate().revert.toggle(!this.get_storyPointCaptionViewModel().get_isCaptured());}this.get_captionTemplate().caption.toggleClass('tabCurrent',this.get_storyPointCaptionViewModel().get_isCurrentPoint());this.get_captionTemplate().caption.attr('data-tb-test-id','tabStoryPoint-'+this.get_storyPointCaptionViewModel().get_storyPointId().toString());this.$k.handleUpdatePoint();},$7:function(){var y=this.get_captionTemplate().revert.find('.tab-iconButton');var z=y.width();if(!tsConfig.is_authoring){var A=(this.get_viewModel().get_width()-z)/2;y.css('left',A+'px');}},$h:function(){this.$f();this.$j();this.$i();},$i:function(){var y=new EventUtils.EventHandleSpec();y.hover=ss.mkdel(this,this.$9);y.hoverDelay=0;var z=y;z.SetHandler('mouseleave',ss.mkdel(this,this.$a));this.disposables.add$1(new EventUtils.TableauEventHandler(this.get_captionTemplate().caption[0],z));},$9:function(y){this.get_viewModel().showUberMenu();},$a:function(){this.get_viewModel().hideUberMenu();},$f:function(){var y='touchstart click';this.get_captionTemplate().caption.on(y,ss.mkdel(this,this.$8));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_captionTemplate().caption.off(y,ss.mkdel(this,this.$8));})));},$j:function(){this.get_captionTemplate().revert.attr('title',tab.Strings.StoryPointRevertTooltip);this.$l=new spiff.IconButton();this.$l.setIcon('tabStoryRevertSmallIcon');this.get_captionTemplate().revert.append(this.$l.element);this.disposables.add$1(this.$l.onClick(ss.mkdel(this,function(y){this.get_storyPointCaptionViewModel().revertStoryPoint();})));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$l.dispose();})));},$g:function(){this.$k.setupContent();},$8:function(y){spiff.EventUtil.stopEvent$2(y);this.get_storyPointCaptionViewModel().clickStoryPoint();}},{$ctor1:function(y,z){this.$k=null;this.$l=null;ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new u());this.get_storyPointCaptionViewModel().add_updatePoint(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().add_flipboardNavTypeChanged(ss.mkdel(this,this.$b));this.get_storyPointCaptionViewModel().set_findCaptionDom(ss.mkdel(this,function(){return this.get_captionTemplate().caption;}));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.get_storyPointCaptionViewModel().remove_updatePoint(ss.mkdel(this,this.$c));this.get_storyPointCaptionViewModel().remove_flipboardNavTypeChanged(ss.mkdel(this,this.$b));this.get_storyPointCaptionViewModel().set_findCaptionDom(null);this.$k.dispose();})));this.$k=z;this.$e();this.$g();this.$h();}});var q=global.tab.StoryNavigatorShapeView=ss.mkType(a,'tab.StoryNavigatorShapeView',function(y){ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new t());},{get_rootTemplate:function(){return this.get_template();},handleUpdatePoint:function(){},styleCaption:function(y){y.domRoot.addClass('tabFormatted');y.domRoot.addClass(q.storyPointDotClassName);y.caption.addClass(q.circleClassName);y.captionBottom.hide();y.captionTop.hide();var z=Math.floor(this.get_viewModel().get_width()*q.dotsScale);var A=Math.floor(this.get_viewModel().get_height()*q.dotsScale);y.caption.width(z+'px');y.caption.height(A+'px');var B=ss.round(y.caption.outerWidth()-y.caption.innerWidth());var C=this.get_viewModel().get_width()-z-B;var D=this.get_viewModel().get_height()-A;C=Math.max(ss.idiv(C,2),0);D=Math.max(ss.idiv(D,2),0);y.caption.css('left',C+'px');y.caption.css('top',D+ss.round(y.toolbar.outerHeight())+'px');},setupContent:function(){this.get_template().domRoot.text('');}});var r=global.tab.StoryNavigatorTableauFontVerticalCenteringHackView=ss.mkType(a,'tab.StoryNavigatorTableauFontVerticalCenteringHackView',function(y){s.call(this,y);},{setupContent:function(){this.constructStoryPointCaptionContentTemplate(this.get_viewModel());var y=new spiff.ScrollableViewModel();y.set_content(this.get_template().domRoot[0]);y.isCenteredVertically=true;y.set_scrollY(false);y.set_scrollX(false);this.scrollableViewModel=y;var z=this.get_viewModel().get_selectedStoryPointStyle().textStyle.fontSize;if(z>14){this.scrollableViewModel.get_content().style.marginTop='-9%';}else{var A=-(0.4677000045776367*z-0.5);this.scrollableViewModel.get_content().style.marginTop=A+'%';}this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.scrollableViewModel.dispose();})));}});var s=global.tab.StoryNavigatorTextView=ss.mkType(a,'tab.StoryNavigatorTextView',function(y){this.scrollableViewModel=null;this.scrollableView=null;ss.makeGenericType(spiff.BaseView$1,[v]).call(this,y,new t());},{get_rootTemplate:function(){return this.get_template();},addToDom:function(y){spiff.Widget.prototype.addToDom.call(this,y);this.scrollableView=spiff.ScrollableView.createScrollableView(this.scrollableViewModel);this.scrollableView.addToDom(y);},styleCaption:function(y){if(this.scrollableViewModel.get_hasCustomIndicator()){y.domRoot.addClass('tabFormatted');y.captionBottom.remove();y.captionTop.remove();}var z=ss.mkdict(['right',this.scrollableView.get_scrollbarBuffer()+'px']);y.captionTop.css(z);y.captionBottom.css(z);},handleUpdatePoint:function(){this.scrollableViewModel.triggerRefresh();},$7:function(){this.scrollableViewModel.triggerRefresh();},setupContent:function(){this.constructStoryPointCaptionContentTemplate(this.get_viewModel());var y=new spiff.ScrollableViewModel();y.set_content(this.get_template().domRoot[0]);y.isCenteredVertically=this.get_viewModel().get_isCenteredVertically();y.set_scrollY(this.get_viewModel().get_navType()!=='number'&&this.get_viewModel().get_navType()!=='arrowonly');y.set_scrollX(false);this.scrollableViewModel=y;this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.scrollableViewModel.dispose();})));},constructStoryPointCaptionContentTemplate:function(y){if(y.get_isCenteredHorizontally()){this.get_template().domRoot.addClass('centered');}this.get_template().domRoot.text(this.get_viewModel().get_caption());}});var t=global.tab.StoryPointCaptionContentTemplate=ss.mkType(a,'tab.StoryPointCaptionContentTemplate',function(){spiff.Template.call(this,$("<div class='tabStoryPointContent'></div>"));});var u=global.tab.StoryPointCaptionTemplate=ss.mkType(a,'tab.StoryPointCaptionTemplate',function(){this.caption=null;this.revert=null;this.update=null;this.updateTextButton=null;this.updateIconButton=null;this.delete$1=null;this.captionTop=null;this.captionBottom=null;this.toolbar=null;spiff.Template.call(this,$("<span class='tabStoryPoint'>\n<div class='tabStoryPointToolbar'>\n  <div class='tabStoryRevert'></div>  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n  <div class='tabStoryDelete'></div></div>\n<div class='tabStoryPointCaption' data-tb-test-id=''><div class='tabStoryPointCaptionTop'></div><div class='tabStoryPointCaptionBottom'></div></div></span>"));this.caption=this.getElementBySelector('.tabStoryPointCaption');this.revert=this.getElementBySelector('.tabStoryRevert');this.toolbar=this.getElementBySelector('.tabStoryPointToolbar');this.captionTop=this.getElementBySelector('.tabStoryPointCaptionTop');this.captionBottom=this.getElementBySelector('.tabStoryPointCaptionBottom');});var v=global.tab.StoryPointViewModel=ss.mkType(a,'tab.StoryPointViewModel',function(y,z){this.$7=null;this.$8=0;this.$4=null;this.$5=null;this.$6=null;this.$2$2=null;this.$2$3=null;this.$2$4=null;this.$2$5=null;this.$2$6=null;this.$2$7=null;this.$2$8=null;this.$2$9=null;this.$2$10=null;this.$2$11=null;spiff.BaseViewModel.call(this);this.$7=y;this.$8=z;this.$7.add_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));this.disposables.add$1(new tab.CallOnDispose(ss.mkdel(this,function(){this.$7.remove_newFlipboardNav(ss.mkdel(this,this.handleNewFlipboardNav));})));},{add_updatePoint:function(y){this.$2$2=ss.delegateCombine(this.$2$2,y);},remove_updatePoint:function(y){this.$2$2=ss.delegateRemove(this.$2$2,y);},add_flipboardNavTypeChanged:function(y){this.$2$3=ss.delegateCombine(this.$2$3,y);},remove_flipboardNavTypeChanged:function(y){this.$2$3=ss.delegateRemove(this.$2$3,y);},add_pointCaptured:function(y){this.$2$4=ss.delegateCombine(this.$2$4,y);},remove_pointCaptured:function(y){this.$2$4=ss.delegateRemove(this.$2$4,y);},add_pointUpdatedShown:function(y){this.$2$5=ss.delegateCombine(this.$2$5,y);},remove_pointUpdatedShown:function(y){this.$2$5=ss.delegateRemove(this.$2$5,y);},add_showUberMenuForPoint:function(y){this.$2$6=ss.delegateCombine(this.$2$6,y);},remove_showUberMenuForPoint:function(y){this.$2$6=ss.delegateRemove(this.$2$6,y);},add_hideUberMenuForPoint:function(y){this.$2$7=ss.delegateCombine(this.$2$7,y);},remove_hideUberMenuForPoint:function(y){this.$2$7=ss.delegateRemove(this.$2$7,y);},add_closeUberMenu:function(y){this.$2$8=ss.delegateCombine(this.$2$8,y);},remove_closeUberMenu:function(y){this.$2$8=ss.delegateRemove(this.$2$8,y);},add_showUpdatedToastOnReload:function(y){this.$2$9=ss.delegateCombine(this.$2$9,y);},remove_showUpdatedToastOnReload:function(y){this.$2$9=ss.delegateRemove(this.$2$9,y);},add_updatedFlipboardStyles:function(y){this.$2$10=ss.delegateCombine(this.$2$10,y);},remove_updatedFlipboardStyles:function(y){this.$2$10=ss.delegateRemove(this.$2$10,y);},add_findParentScroller:function(y){this.$2$11=ss.delegateCombine(this.$2$11,y);},remove_findParentScroller:function(y){this.$2$11=ss.delegateRemove(this.$2$11,y);},$3:function(){return this.$7.get_storyPoints()[this.$8];},get_isCurrentPoint:function(){return this.$8===this.$7.get_currentPointIndex();},get_isCaptured:function(){return this.$3().isCaptured;},get_caption:function(){var y=this.$3().storyPointCaption;return ((ss.isNullOrEmptyString(y)&&tsConfig.is_authoring)?tab.Strings.StoryEmptyCaptionText:y);},get_authoringCaption:function(){return this.$3().storyPointCaption;},get_storyPointId:function(){return this.$3().storyPointId;},get_storyPointIndex:function(){return this.$8;},set_StoryPointIndex:function(y){this.$8=y;},get_isFirstPoint:function(){return this.get_storyPointIndex()===0;},get_isLastPoint:function(){return this.$8===this.$7.get_storyPoints().length-1;},get_isOnlyPoint:function(){return this.get_isFirstPoint()&&this.get_isLastPoint();},get_storyPointStyle:function(){if(this.get_isCurrentPoint()){return this.get_selectedStoryPointStyle();}else{return this.get_unselectedStoryPointStyle();}},get_selectedStoryPointStyle:function(){return this.$7.get_flipboardNavPresModel().selectedStoryPointStyle;},get_unselectedStoryPointStyle:function(){return this.$7.get_flipboardNavPresModel().unselectedStoryPointStyle;},get_width:function(){return this.$7.get_width();},get_height:function(){return this.$7.get_height();},get_isCenteredHorizontally:function(){return this.$7.get_navType()==='number'||this.$7.get_navType()==='arrowonly';},get_isCenteredVertically:function(){return this.$7.get_navType()==='number'||this.$7.get_navType()==='arrowonly';},get_navType:function(){return this.$7.get_navType();},get_isStoryEmpty:function(){return this.$7.get_isStoryEmpty();},get_findCaptionDom:function(){if(ss.staticEquals(this.$5,null)||ss.staticEquals(this.$2$11,null)){return function(){return null;};}var y=this.$2$11();var z=this.$5();return ss.mkdel(this,function(){return this.determineCorrectCaptionDom(y,z);});},set_findCaptionDom:function(y){this.$5=y;},determineCorrectCaptionDom:function(y,z){var A=this.$0(y,z);if(A.w<z.width()){this.$6=this.$1(A);y[0].appendChild(this.$6.get(0));return this.$6;}return z;},get_shouldBeAdded:function(){return this.get_navType()==='arrowonly'&&this.get_isCurrentPoint()||this.get_navType()!=='arrowonly';},handleNewFlipboardNav:function(){var y=this.get_navType()!==this.$4;if(y){this.raiseActionEvent(this.$2$3);}else{this.raiseActionEvent(this.$2$2);}this.$4=this.get_navType();},notifyPointWasCaptured:function(){this.raiseActionEvent(this.$2$4);},notifyPointUpdatedWasShown:function(){this.raiseActionEvent$1(ss.UInt32).call(this,this.$2$5,this.get_storyPointId());},notifyFlipboardStylesUpdated:function(){this.raiseActionEvent(this.$2$10);},showUberMenu:function(){this.raiseActionEvent$1(ss.UInt32).call(this,this.$2$6,this.get_storyPointId());},hideUberMenu:function(){this.raiseActionEvent$1(ss.UInt32).call(this,this.$2$7,this.get_storyPointId());},closeUber:function(){this.raiseActionEvent(this.$2$8);},markPointUpdated:function(){this.raiseActionEvent$1(ss.UInt32).call(this,this.$2$9,this.get_storyPointId());},clickStoryPoint:function(){return this.$2(ss.mkdel(this,function(){v.set_isAnyStoryPointLoading(true);return l.setActiveStoryPoint(this.$8,this.$7);}),this.get_isCurrentPoint()).then(function(y){v.set_isAnyStoryPointLoading(false);return y;},null);},revertStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return l.revertStoryPoint(tab.ModelUtils.findContentDashboard(null).get_sheetPath(),this.$3().storyPointId);}),this.get_isCaptured());},captureStoryPoint:function(){return this.$2(ss.mkdel(this,function(){return l.captureStoryPoint(this.get_storyPointId());}),this.get_isCaptured());},deleteStoryPoint:function(){tab.DashboardModel.handleStoryPointDeleted(this.get_storyPointId());return this.$2(ss.mkdel(this,function(){return l.deleteStoryPoint(this.get_storyPointId());}),false);},editStoryPointCaption:function(y){return this.$2(ss.mkdel(this,function(){return l.editStoryPointCaption(y,this.get_storyPointId(),this.$7);}),ss.compareStrings(this.get_caption(),y,false)===0);},$2:function(y,z){var A=$.Deferred();if(z){return A.resolve(this);}else{var B=ss.mkdel(this,function(){A.resolve(this);});var C=function(){A.reject(ss.cast(arguments[0],tab.IStoryPointCaptionViewModel));};var D=y();D.then(B,C);}return A.promise();},removeIntersectionCaption:function(){if(ss.isValue(this.$6)){this.$6.remove();this.$6=null;}},$0:function(y,z){var A=y[0].getBoundingClientRect();var B=z[0].getBoundingClientRect();var C=Math.max(A.left,B.left);var D=Math.min(A.right,B.right);var E=D-C;var F=C-A.left;var G={x:F,y:B.top-A.top,w:E,h:B.height};return G;},$1:function(y){var z=$("<div class='tabStoryPointIntersectionCaption'></div>");z.css({height:y.h+'px',top:y.y+'px',left:y.x+'px',width:y.w+'px'});return z;}},{get_isAnyStoryPointLoading:function(){return v.$2$1;},set_isAnyStoryPointLoading:function(y){v.$2$1=y;}});var w=global.tab.StoryUIEvents=ss.mkType(a,'tab.StoryUIEvents',null,null,{$2:function(y){w.$1$1=ss.delegateCombine(w.$1$1,y);},$3:function(y){w.$1$1=ss.delegateRemove(w.$1$1,y);},$4:function(y){w.$1$2=ss.delegateCombine(w.$1$2,y);},$5:function(y){w.$1$2=ss.delegateRemove(w.$1$2,y);},$0:function(){if(!ss.staticEquals(w.$1$1,null)){w.$1$1();}},$1:function(y){if(!ss.staticEquals(w.$1$2,null)){w.$1$2(y);}}});var x=global.tab.ViewingUberPopupContainer=ss.mkType(a,'tab.ViewingUberPopupContainer',function(){this.$1$1=0;this.$1$2=0;},{get_isShowing:function(){return false;},get_isShowingWithHide:function(){return false;},get_targetStoryPointId:function(){return 0;},get_timeoutMs:function(){return this.$1$1;},set_timeoutMs:function(y){this.$1$1=y;},get_fadeMs:function(){return this.$1$2;},set_fadeMs:function(y){this.$1$2=y;},updatePoints:function(y,z){},showUber:function(y){},hideUberWithTimeoutAndFade:function(){},hideUberWithFade:function(){},showUberWithTimeoutAndFade:function(y){},close:function(){},dispose:function(){}});ss.initClass(b);ss.initClass(c,spiff.Template,[ss.IDisposable]);ss.initClass(d,ss.makeGenericType(spiff.BaseView$1,[tab.IFlipboardNavigatorViewModel]),[tab.IWidget,tab.IFlipboardNavigatorView,ss.makeGenericType(tab.IView$1,[tab.IFlipboardNavigatorViewModel]),ss.IDisposable,tab.IAppendableView]);ss.initClass(e,spiff.BaseViewModel,[tab.IFlipboardNavigatorViewModel,tab.IViewModel,ss.IDisposable,tab.ICanRequireHandlingOfContextMenuEvents]);ss.initClass(f,spiff.Template,[ss.IDisposable]);ss.initClass(g,ss.makeGenericType(spiff.BaseView$1,[h]),[tab.IWidget,ss.makeGenericType(tab.IView$1,[h]),ss.IDisposable,tab.IAppendableView]);ss.initClass(h,spiff.BaseViewModel,[tab.IViewModel,ss.IDisposable,tab.IFlipboardViewModel]);ss.initInterface(i,{get_rootTemplate:null,styleCaption:null,handleUpdatePoint:null,setupContent:null},[ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);ss.initInterface(j,{get_contentTemplate:null,get_captionTemplate:null,get_storyNavigatorContentView:null},[ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);ss.initInterface(k,{get_isShowing:null,get_isShowingWithHide:null,get_targetStoryPointId:null,get_timeoutMs:null,set_timeoutMs:null,get_fadeMs:null,set_fadeMs:null,updatePoints:null,showUber:null,hideUberWithTimeoutAndFade:null,hideUberWithFade:null,showUberWithTimeoutAndFade:null,close:null},[ss.IDisposable]);ss.initClass(l);ss.initClass(m,null,[tab.IStoryModule]);ss.initClass(n);ss.initClass(o);ss.initClass(p,ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,j,ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);p.$ctor1.prototype=p.prototype;ss.initClass(q,ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,i,ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);ss.initClass(s,ss.makeGenericType(spiff.BaseView$1,[v]),[tab.IWidget,i,ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);ss.initClass(r,s,[tab.IWidget,i,ss.makeGenericType(tab.IView$1,[v]),ss.IDisposable,tab.IAppendableView]);ss.initClass(t,spiff.Template,[ss.IDisposable]);ss.initClass(u,spiff.Template,[ss.IDisposable]);ss.initClass(v,spiff.BaseViewModel,[tab.IViewModel,ss.IDisposable,tab.IStoryPointCaptionViewModel]);ss.initClass(w);ss.initClass(x,null,[k,ss.IDisposable]);(function(){c.$0="<span class='tabFlipboardNavPoints'></span>";})();(function(){d.horizontalScrollerSelector='.tabFlipboardNavScroller '+'.iScrollHorizontalScrollbar';d.horizontalScrollerHoverSelector='.tabFlipboardNavScroller '+'.iScrollHorizontalScrollbar:hover';d.horizontalScrollerIndicatorSelector='.tabFlipboardNavScroller '+'.iScrollHorizontalScrollbar>.iScrollIndicator';d.horizontalScrollerIndicatorHoverSelector='.tabFlipboardNavScroller '+'.iScrollHorizontalScrollbar>.iScrollIndicator:hover';d.storyPointSelector='.tabFlipboardNavScroller '+'.tabScroller .tabScrollerContent .tabFlipboardNavPoints .tabStoryPoint';d.selectedStoryPointBoxSelector='.tabStoryPointCaption.tabCurrent';d.unselectedStoryPointBoxSelector='.tabStoryPointCaption';d.selectedStoryPointTextSelector='.tabStoryPointCaption.tabCurrent'+' .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';d.unselectedStoryPointTextSelector='.tabStoryPointCaption'+' .tabCustomScroller .tabScrollerContentWindow .tabScrollerContent .tabStoryPointContent';d.selectedStoryPointScrollbarSelector='.tabStoryPointCaption.tabCurrent'+' .tabCustomScroller .tabVerticalScrollbar';d.unselectedStoryPointScrollbarSelector='.tabStoryPointCaption'+' .tabCustomScroller .tabVerticalScrollbar';d.selectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption.tabCurrent'+' .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';d.unselectedStoryPointScrollbarIndicatorSelector='.tabStoryPointCaption'+' .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator';d.selectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption.tabCurrent'+' .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';d.unselectedStoryPointScrollbarIndicatorHoverSelector='.tabStoryPointCaption'+' .tabCustomScroller .tabVerticalScrollbar>.tabScrollbarIndicator:hover';d.selectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionTop,'+'.tabStoryPointCaption.tabCurrent .tabStoryPointCaptionBottom';d.unselectedStoryPointNativeScrollerTopBottomSelector='.tabStoryPointCaption.tabStoryPointCaptionTop,'+'.tabStoryPointCaption .tabStoryPointCaptionBottom';d.selectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption.tabCurrent'+' .tabScroller .tabScrollerContent .tabStoryPointContent';d.unselectedStoryPointNativeScrollerTextSelector='.tabStoryPointCaption'+' .tabScroller .tabScrollerContent .tabStoryPointContent';d.storyStyleSheetId='appendedStoryStyle';tab.ObjectRegistry.registerDeferredType(tab.IFlipboardNavigatorView).call(null);if(!tsConfig.is_authoring){tab.ObjectRegistry.resolveDeferredType(tab.IFlipboardNavigatorView).call(null,d);}})();(function(){v.$2$1=false;})();(function(){w.$1$1=null;w.$1$2=null;})();(function(){f.$0="<div class='"+'tabFlipboard'+"'></div>";})();(function(){g.scrollBarThickness=24;g.additionalHeightForMarginsOfContent=3;tab.ObjectRegistry.registerType(g,g).call(null);})();(function(){t.$0="<div class='tabStoryPointContent'></div>";})();(function(){q.circleClassName='tabStoryPointCircle';q.storyPointDotClassName='tabStoryPointDot';q.dotsScale=0.75;})();(function(){s.centeredClassName='centered';s.paddedClassName='padded';})();(function(){u.$0="<span class='tabStoryPoint'>\n"+"<div class='tabStoryPointToolbar'>\n"+"  <div class='tabStoryRevert'></div>"+"  <div class='tabStoryUpdate'><div class='tabStoryUpdateTextButton'></div><div class='tabStoryUpdateIconButton'></div></div>\n"+"  <div class='tabStoryDelete'></div>"+'</div>\n'+"<div class='tabStoryPointCaption' data-tb-test-id=''>"+"<div class='tabStoryPointCaptionTop'></div><div class='tabStoryPointCaptionBottom'></div>"+'</div></span>';})();(function(){p.centeredClassName='centered';p.buttonPixelBuffer=12;p.revertUpdateSpacing=4;p.storyPointTestIdPrefix='tabStoryPoint-';tab.ObjectRegistry.registerDeferredType(j).call(null);if(!tsConfig.is_authoring){tab.ObjectRegistry.resolveDeferredType(j).call(null,p);}})();(function(){tab.ObjectRegistry.registerDeferredType(k).call(null);if(!tsConfig.is_authoring){tab.ObjectRegistry.resolveDeferredType(k).call(null,x);}})();})();// END StoryModule
